<div class="white box-shadow sub-header">
    <div class="row">
        <div class="col-md-12">
            <div class="padding">
                <div class="text-right ">
                    <div class="pull-left">
                        <span class="text-md text-orange _600 p-t-xs">
                          <ol class="breadcrumb p-t-xs">
                                <li (click)="coreService.backClicked()">
                                    <a><i title="back" class="fa fa-arrow-circle-left" style="font-size: 18px"></i></a>
                                </li>
                                <li class="active">
                                    <span>{{'label.auditLog' | translate }}</span>
                                </li>
                            </ol>
                        </span>
                    </div>
                    <label class="md-check">
                        <input type="checkbox" [(ngModel)]="adtLog.current" name="checkbox" (click)="changeJobScheduler()">
                        <i class="primary"></i><span translate>label.currentJobscheduler</span>
                    </label>

                    <div class="btn-group m-l-sm hidden-btn-group">
                        <button class="btn btn-default btn-sm" (click)="load('all')"
                                [ngClass]="{'btn-primary': adtLog.filter.date=='all'}" translate>button.all
                        </button>
                        <button class="btn btn-default btn-sm" (click)="load('today')"
                                [ngClass]="{'btn-primary': adtLog.filter.date=='today'}" translate>button.today
                        </button>
                        <button class="btn btn-default btn-sm" (click)="load('-1h')"
                                [ngClass]="{'btn-primary': adtLog.filter.date=='-1h'}" translate>button.last1
                        </button>
                        <button class="btn btn-default btn-sm" (click)="load('-12h')"
                                [ngClass]="{'btn-primary': adtLog.filter.date=='-12h'}" translate>button.last12
                        </button>
                        <button class="btn btn-default btn-sm" (click)="load('-1d')"
                                [ngClass]="{'btn-primary': adtLog.filter.date=='-1d'}" translate>button.last24
                        </button>
                        <button class="btn btn-default btn-sm"  (click)="load('-1w')"
                                [ngClass]="{'btn-primary': adtLog.filter.date=='-1w'}" translate>button.lastWeak
                        </button>
                    </div>
                    <div class="btn-group dropdown hidden-dropdown">
                        <button class="btn btn-default btn-sm m-l-sm dropdown-toggle" data-toggle="dropdown" translate>label.anyDate</button>
                        <div class="dropdown-menu dropdown-menu-scale dropdown-ac dropdown-more pull-right">
                            <a class="dropdown-item"  (click)="load('all')"
                               [ngClass]="{'btn-primary': adtLog.filter.date=='all'}" translate>button.all
                            </a>
                            <a class="dropdown-item"  (click)="load('today')"
                               [ngClass]="{'btn-primary': adtLog.filter.date=='today'}" translate>button.today
                            </a>
                            <a class="dropdown-item"  (click)="load('-1h')"
                               [ngClass]="{'btn-primary': adtLog.filter.date=='-1h'}" translate>button.last1
                            </a>
                            <a class="dropdown-item" (click)="load('-12h')"
                               [ngClass]="{'btn-primary': adtLog.filter.date=='-12h'}" translate>button.last12
                            </a>
                            <a class="dropdown-item" (click)="load('-1d')"
                               [ngClass]="{'btn-primary': adtLog.filter.date=='-1d'}" translate>button.last24
                            </a>
                            <a class="dropdown-item" (click)="load('-1w')"
                               [ngClass]="{'btn-primary': adtLog.filter.date=='-1w'}" translate>button.lastWeak
                            </a>
                        </div>
                    </div>
                    <button class="btn btn-default btn-sm m-l-sm" ngbTooltip="{{'tooltip.exportInXLS' | translate}}" [disabled]="(auditLogs | filter: searchKey).length===0" id="exportToExcelBtn" (click)="exportToExcel()"><i>.</i></button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="scroll-y max-ht">
    <div class="padding p-b-0" >
        <div class="row m-b m-t-xs">
            <div class="col-lg-12">
                <button class="btn btn-sm inline pull-right m-l btn-default" (click)="advancedSearch()" *ngIf="!showSearchPanel">
                    <span translate>button.advancedSearch</span> <i class="fa fa-angle-down p-l-xs"></i>
                </button>
                <button class="btn btn-sm inline pull-right m-l btn-default" (click)="cancel()" *ngIf="showSearchPanel">
                    <span translate>button.advancedSearch</span> <i class="fa fa-angle-down p-l-xs"></i>
                </button>
                <input type="search" class="pull-right" placeholder="{{'placeholder.search' | translate}}" [(ngModel)]="searchKey" name="search" style="width: 180px">
            </div>
        </div>
        <div class="row m-b hide" [ngClass]="{'show':showSearchPanel}">

            <div class="col-md-12">
                <div class="box p-a m-b-xs">
                    <form #myForm="ngForm" (ngSubmit)="search()">
                        <div class="m-b-sm row">
                            <label class="col-md-2 col-sm-4 form-control-label" translate>label.dateRange</label>
                            <div class="col-md-6">
                                <label class="md-check w-sm">
                                    <input type="radio" name="radio" [(ngModel)]="auditSearch.date" value="date">
                                    <i class="primary"></i> <span translate>label.specificDate</span>
                                </label>
                                <label class="md-check">
                                    <input type="radio" name="radio" [(ngModel)]="auditSearch.date" value="process">
                                    <i class="primary"></i> <span translate>label.manualDate</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group row"  *ngIf="auditSearch.date === 'process'" [ngClass]="{'has-error' : ((processExc.dirty || processExc.touched) && processExc.invalid)}">
                            <label class="col-md-2 col-sm-4 form-control-label" translate>label.processExecuted</label>
                            <div class=" col-sm-6">
                                <input class="form-control" validateEqual #processExc="ngModel" required type="text"
                                       name="planned" class="form-control" placeholder="{{'placeholder.processExecuted' | translate}}"
                                       [(ngModel)]="auditSearch.planned">
                                <div *ngIf="processExc.errors && (processExc.dirty || processExc.touched)" class="help-block text-danger" >
                                      <div *ngIf="processExc.errors.required">
                                          <div translate>message.requiredError</div>
                                      </div>
                                     <div translate *ngIf="!processExc.valid">message.invalid</div>
                                </div>

                            </div>
                        </div>
                        <div class="form-group row " *ngIf="auditSearch.date === 'date'" [ngClass]="{'has-error': (fromTime.dirty || fromTime.touched) && fromTime.invalid}">
                            <label class="col-sm-2 form-control-label" translate>label.from</label>
                            <div class="col-sm-6">
                                <dp-date-picker [theme]="'dp-material dp-main'" placeholder="{{'placeholder.setStartDate' | translate}} ({{dateFormat | uppercase}})" [(ngModel)]="auditSearch.from" name="from" [config]="config"> </dp-date-picker>
                                <input timevalidator maxlength="8" pattern="([01]?[0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9]" [disabled]="!auditSearch.from"  #fromTime="ngModel" class="form-control input-time m-l time-picker" [(ngModel)]="auditSearch.fromTime" name="fromTime"
                                       placeholder="{{'placeholder.startTime' | translate}} (HH:MM:SS)" type="text">
                            </div>
                        </div>
                        <div class="form-group row" *ngIf="auditSearch.date === 'date'" [ngClass]="{'has-error': ((toTime.dirty || toTime.touched) && toTime.invalid)}">
                            <label class="col-sm-2 form-control-label" translate>label.to</label>
                            <div class="col-sm-6" [ngClass]="{'has-error': ((to.dirty || to.touched) && to.invalid)}">
                                <dp-date-picker [theme]="'dp-material dp-main'" placeholder="{{'placeholder.setEndDate' | translate}} ({{dateFormat | uppercase}})" [(ngModel)]="auditSearch.to" [minDate]="auditSearch.from" displayDate="" #to="ngModel"  name="to" [config]="config"> </dp-date-picker>
                                <input timevalidator maxlength="8" pattern="([01]?[0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9]" [disabled]="!auditSearch.to" class="form-control input-time m-l time-picker" [(ngModel)]="auditSearch.toTime" name="toTime" #toTime="ngModel"
                                       placeholder="{{'placeholder.endTime' | translate}} (HH:MM:SS)" type="text">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-2 form-control-label" translate>label.comment</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" placeholder="{{'placeholder.enterComment' | translate}}" [(ngModel)]="auditSearch.regex" name="regex">
                            </div>
                        </div>
                        <div class="form-group row" >
                           <label class="col-md-2 col-sm-4 form-control-label" translate>label.jobSchedulerId</label>
                           <div class=" col-sm-6">
                               <select class="form-control" [(ngModel)]="auditSearch.jobschedulerId" name="id">
                                    <option value="" translate="">label.selectJobScheduler</option>
                                   <option *ngFor="let jobScheduler of schedulerIds.jobschedulerIds">{{jobScheduler}}</option>
                               </select>
                           </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-2 form-control-label" translate>label.jobChain</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" placeholder="{{'placeholder.enterJobChainPath' | translate}}" [(ngModel)]="auditSearch.jobChain" name="jobchain">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-2 form-control-label" translate>label.orderIds</label>
                            <div class="col-sm-6">
                                 <input type="text" class="form-control" placeholder="{{'placeholder.enterOrderIds' | translate}}" [(ngModel)]="auditSearch.orderIds" name="orderid">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-2 form-control-label" translate>label.job</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" placeholder="{{'placeholder.enterJobs' | translate}}" [(ngModel)]="auditSearch.job" name="job">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-2 form-control-label" translate>label.calendar</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" placeholder="{{'placeholder.enterCalendars' | translate}}" [(ngModel)]="auditSearch.calendars" name="calendar">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-2 form-control-label" translate>label.account</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" placeholder="{{'placeholder.enterAccount' | translate}}" [(ngModel)]="auditSearch.account" name="account">
                            </div>
                        </div>
                        <div class="form-group m-t m-b-xs">
                            <button type="submit" class="btn btn-primary btn-sm" [disabled]="!myForm.valid" translate>button.search</button>
                            <button type="button" class="btn btn-default btn-sm m-l-sm" (click)="cancel()" translate>button.cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="hide"  [ngClass]="{'show': isLoaded}">
            <div class="m-t-sm box p-a">
                <div class="table-responsive">
                    <table class="table table-hover table-bordered " id="auditLogTableId" >
                        <thead>
                            <tr>
                                <th *ngIf="!adtLog.current" (click)="sortBy('jobschedulerId')"><a><span translate>label.jobSchedulerId</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'jobschedulerId' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'jobschedulerId' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th (click)="sortBy('created')"><a><span translate>label.created</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'created' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'created' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th (click)="sortBy('account')"><a><span translate>label.account</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'account' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'account' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th (click)="sortBy('request')"><a><span translate>label.request</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'request' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'request' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th (click)="sortBy('jobChain')"><a><span translate>label.jobChain</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'jobChain' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'jobChain' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th (click)="sortBy('orderId')">
                                <a><span translate>label.orderId</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'orderId' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'orderId' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th (click)="sortBy('job')"><a><span translate>label.job</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'job' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'job' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th (click)="sortBy('calendar')"><a><span translate>label.calendar</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'calendar' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'calendar' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th (click)="sortBy('comment')"><a><span translate>label.comment</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'comment' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'comment' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th (click)="sortBy('timeSpent')"><a><span translate>label.timeSpend</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'timeSpent' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'timeSpent' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th (click)="sortBy('ticketLink')"><a><span translate>label.ticketLink</span>
                                    <i *ngIf="adtLog.filter.sortBy == 'ticketLink' && !adtLog.reverse"
                                       class="fa fa-caret-up "></i>
                                    <i *ngIf="adtLog.filter.sortBy == 'ticketLink' && adtLog.reverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                            </tr>
                        </thead>
                        <tbody *ngFor="let auditLog of auditLogs | filter: searchKey | orderBy: adtLog.filter.sortBy:adtLog.reverse:'case-insensitive' | paginate: { itemsPerPage: preferences.entryPerPage  , currentPage: adtLog.currentPage }">
                        <tr>
                            <td *ngIf="!adtLog.current">
                                <i class="cursor fa fa-caret-down fa-lg tableexport-ignore" *ngIf="!auditLog.show"
                                   (click)="auditLog.show =true"></i>
                                <i class="cursor fa fa-caret-up fa-lg tableexport-ignore" *ngIf="auditLog.show"
                                   (click)="auditLog.show = false"></i>
                                <span [innerHtml]="auditLog.jobschedulerId"></span>
                                <span *ngIf="!auditLog.jobschedulerId" [innerHtml]="auditSearch.jobschedulerId"></span>
                            </td>
                            <td nowrap>
                                <i class="cursor fa fa-caret-down fa-lg tableexport-ignore"
                                   *ngIf="!auditLog.show && adtLog.current" (click)="auditLog.show =true"></i>
                                <i class="cursor fa fa-caret-up fa-lg tableexport-ignore"
                                   *ngIf="auditLog.show && adtLog.current" (click)="auditLog.show = false"></i>
                                <span [innerHtml]="auditLog.created | stringToDate"></span></td>
                            <td><span [innerHtml]="auditLog.account"></span></td>
                            <td><span [innerHtml]="auditLog.request"></span></td>
                            <td><span (click)="showJobChain(auditLog.jobChain);" class="text-hover-primary" [innerHtml]="auditLog.jobChain"></span></td>
                            <td><span (click)="showOrderLink(auditLog.jobChain);" class="text-hover-primary" [innerHtml]="auditLog.orderId"></span></td>
                            <td><span (click)="showJob(auditLog.job);" class="text-hover-primary" [innerHtml]="auditLog.job"></span></td>
                            <td><span (click)="showCalendarLink(auditLog.calendar);" class="text-hover-primary" [innerHtml]="auditLog.calendar"></span></td>
                            <td><span [innerHtml]="auditLog.comment"></span></td>
                            <td>
                                <span *ngIf="auditLog.timeSpent">
                                    <span [innerHtml]="auditLog.timeSpent"></span>
                                    <span>m</span>
                                </span>
                            </td>
                            <td><a href="{{auditLog.ticketLink}}" target="_blank" class="text-hover-primary" [innerHtml]="auditLog.ticketLink"></a></td>
                        </tr>
                        <tr class="tableexport-ignore" *ngIf="auditLog.show">
                            <td colspan="10">
                                <table class="table m-a-0">
                                    <thead>
                                    <tr class="tableexport-ignore">
                                        <th translate>label.parameters</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr class="tableexport-ignore">
                                        <td><span [innerHtml]="auditLog.parameters"></span></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <pagination-controls class="pagination" (pageChange)="adtLog.currentPage = $event" previousLabel="Prev" nextLabel="Next" autoHide="true"></pagination-controls>
                    <div class="pull-left m-l-xs m-b" *ngIf="(auditLogs | filter: searchKey).length > 10">
                      <div class="btn-group btn-group-toggle" ngbRadioGroup name="radioBasic"
                           [(ngModel)]="preferences.entryPerPage">
                          <label ngbButtonLabel class="btn btn-default white btn-sm"
                                 [ngClass]="{'primary': preferences.entryPerPage=='10'}">
                              <input ngbButton type="radio" [value]="10"> 10
                          </label>
                          <label ngbButtonLabel class="btn btn-default white btn-sm"
                                 [ngClass]="{'primary': preferences.entryPerPage=='25'}">
                              <input ngbButton type="radio" [value]="25"> 25
                          </label>
                          <label ngbButtonLabel class="btn btn-default white btn-sm"
                                 [ngClass]="{'primary': preferences.entryPerPage=='50'}">
                              <input ngbButton type="radio" [value]="50"> 50
                          </label>
                          <label ngbButtonLabel class="btn btn-default white btn-sm"
                                 [ngClass]="{'primary': preferences.entryPerPage=='100'}">
                              <input ngbButton type="radio" [value]="100"> 100
                          </label>
                          <label ngbButtonLabel class="btn btn-default white btn-sm"
                                 [ngClass]="{'primary': preferences.entryPerPage== preferences.maxEntryPerPage}">
                              <input ngbButton type="radio" [value]="preferences.maxEntryPerPage"> {{preferences.maxEntryPerPage}}
                          </label>
                      </div>
                  </div>
                    <div class="inline text-sm m-t-xs m-l-sm"  *ngIf="(auditLogs | filter: searchKey).length >0"><span translate>label.total</span> {{(auditLogs | filter: searchKey).length}}
                        <span  *ngIf="(auditLogs | filter: searchKey).length >1" translate>label.auditLogsFound</span>
                        <span  *ngIf="(auditLogs | filter: searchKey).length ==1" translate>label.auditLogFound</span>
                    </div>
                    <div class="text-center m-t text-uppercase hide text-orange" [ngClass]="{'show': ((auditLogs | filter: searchKey).length===0 && auditLogs.length >0)}" translate>message.noDataMatched</div>
                </div>
                <div *ngIf="isLoaded && auditLogs.length==0" class="text-center m-t-md h6 text-uppercase" translate>message.noAuditLogFound</div>
            </div>
        </div>
        <div  *ngIf="!isLoaded" class="text-center m-t-lg" >
            <div class="cssload-loading">{{'label.loading' | translate}}...</div>
        </div>
    </div>
</div>
<div *ngIf="loading" class="loading-img1"></div>


