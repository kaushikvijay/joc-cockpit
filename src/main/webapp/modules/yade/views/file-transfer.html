<div class="white box-shadow sub-header">
    <div class="row">
        <div class="col-md-12">
            <div class="padding">
                <div class="text-right ">
                    <div class="pull-left">
                        <span class="text-md text-orange _600 p-t-xs" ncy-breadcrumb></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="scroll-y max-ht" >
    <div class="padding p-b-0">
        <div class="m-t-sm box p-a" ng-show="isLoading">
                <div class="table-responsive">
                    <table class="table table-hover table-bordered " id="yade">
                        <thead>
                            <tr>
                                <th ng-if="permission.YADE.execute.transferStart && fileTransfers[0].state._text=='FAILED'" width="45"><span translate>label.action</span></th>
                                <th ng-click="sortBy('status')"><a><span translate>label.status</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'status' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'status' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th ng-click="sortBy('mandator')"><a><span translate>label.mandator</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'mandator' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'mandator' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th ng-if="!yadeView.current" ng-click="sortBy('jobschedulerId')"><a><span translate>label.jobSchedulerId</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'jobschedulerId' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'jobschedulerId' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th ng-click="sortBy('operation')"><a><span translate>label.operation</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'operation' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'operation' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th ng-click="sortBy('source.host')"><a><span translate>label.sourceHost</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'source.host' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'source.host' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th ng-click="sortBy('target.host')"><a><span translate>label.targetHost</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'target.host' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'target.host' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th ng-click="sortBy('target.protocol')"><a><span translate>label.targetProtocol</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'target.protocol' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'target.protocol' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th ng-click="sortBy('numOfFiles')"><a><span translate>label.totalNumberOfFiles</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'numOfFiles' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'numOfFiles' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th ng-click="sortBy('start')"><a><span translate>label.startTime</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'start' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'start' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th ng-click="sortBy('end')"><a><span translate>label.endTime</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'end' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'end' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                                <th ng-click="sortBy('duration')">
                                    <a><span translate>label.duration</span>
                                    <i ng-show="yadeFilters.filter.sortBy == 'duration' && !yadeFilters.sortReverse"
                                       class="fa fa-caret-up "></i>
                                    <i ng-show="yadeFilters.filter.sortBy == 'duration' && yadeFilters.sortReverse"
                                       class="fa fa-caret-down "></i></a>
                                </th>
                            </tr>
                        </thead>
                        <tbody ng-repeat="transfer in fileTransfers">
                        <tr  class="cursor">

                            <td ng-if="permission.YADE.execute.transferStart && transfer.state._text=='FAILED'">
                                <div class="btn-group dropdown"  >
                                    <button type="button" class="btn-drop more-option-h"  data-toggle="dropdown" ><i
                                            class="fa fa-ellipsis-h"></i></button>
                                    <div class="dropdown-menu dropdown-menu-list dropdown-ac dropdown-more" role="menu">
                                        <a class="dropdown-item"
                                           ng-click="restartTransfer(transfer)"
                                           translate>button.restart</a>
                                    </div>
                                </div>
                            </td>
                            <td class="nowrap" >
                                <i class="cursor fa fa-caret-down fa-lg " ng-if="!transfer.show" ng-click="showTransferFuc(transfer);"></i>
                                 <i class="cursor fa fa-caret-up fa-lg " ng-if="transfer.show" ng-click="transfer.show = false;"></i>
                                <span uib-tooltip="{{transfer.error.message}}" class="label" ng-class="bgColorFunction(transfer.state.severity)" ng-bind="transfer.state._text | translate"></span>
                            </td>
                            <td ng-bind="transfer.mandator"></td>
                            <td ng-if="!yadeView.current" >
                                 <span ng-bind="yade.jobschedulerId"></span>
                                 <span ng-if="!yade.jobschedulerId" ng-bind="transfer.jobschedulerId"></span>
                             </td>
                            <td ng-bind="transfer._operation"></td>
                            <td ng-bind="transfer.source.host"></td>
                            <td ng-bind="transfer.target.host"></td>
                            <td ng-bind="transfer.target.protocol"></td>
                            <td ng-bind="transfer.numOfFiles"></td>
                            <td ng-bind="transfer.start | stringToDate"></td>
                            <td ng-bind="transfer.end | stringToDate"></td>
                            <td ng-bind="transfer.start | duration:transfer.end"></td>
                        </tr>
                        <tr ng-show="transfer.show">
                            <td></td>
                            <td colspan="12" >
                                 <table class="table m-a-0">
                                     <thead>
                                     <tr>
                                         <th translate>label.sourceHostUser</th>
                                         <th translate>label.sourceHostPort</th>
                                         <th translate>label.sourceHostProtocol</th>
                                         <th translate>label.targetHostUser</th>
                                         <th translate>label.targetHostPort</th>
                                         <th translate>label.targetHostProtocol</th>
                                         <th translate>label.jumpHost</th>
                                         <th translate>label.jumpUser</th>
                                         <th translate>label.jumpPort</th>
                                         <th translate>label.jumpProtocol</th>
                                         <th translate>label.jobChain</th>
                                         <th translate>label.job</th>
                                         <th translate>label.order</th>
                                     </tr>
                                     </thead>
                                     <tbody>
                                     <tr>
                                        <td  ng-bind="transfer.source.account"></td>
                                        <td  ng-bind="transfer.source.port"></td>
                                        <td  ng-bind="transfer.source.protocol"></td>
                                        <td  ng-bind="transfer.target.account"></td>
                                        <td  ng-bind="transfer.target.port"></td>
                                        <td  ng-bind="transfer.target.protocol"></td>
                                        <td  ng-bind="transfer.jump.host"></td>
                                        <td  ng-bind="transfer.jump.account"></td>
                                        <td  ng-bind="transfer.jump.port"></td>
                                        <td  ng-bind="transfer.jump.protocol"></td>
                                        <td><span ng-click="showJobChain(transfer.jobChain);" class="text-hover-primary" ng-bind="transfer.jobChain"></span></td>
                                        <td><span ng-click="showJob(transfer.job);" class="text-hover-primary" ng-bind="transfer.job"></span></td>
                                        <td><span ng-click="showOrderLink(transfer.orderId);" class="text-hover-primary" ng-bind="transfer.orderId"></span></td>
                                     </tr>
                                     </tbody>
                                 </table>
                             </td>
                        </tr>
                        <tr ng-show="transfer.show">
                            <td></td>
                            <td colspan="12" >
                                 <table class="table m-a-0">
                                     <thead>
                                     <tr>
                                         <th width="30" ng-if="permission.YADE.execute.transferStart">
                                            <label class="md-check lg-check">
                                                <input type="checkbox" ng-model="checkAllFiles.checkbox" ng-click="checkAllFilesFnc(transfer)"><i class="primary"></i>
                                            </label>
                                        </th>
                                         <th translate>label.sourceFileName</th>
                                         <th translate>label.sourceFilePath</th>
                                         <th translate>label.targetFileName</th>
                                         <th translate>label.targetFilePath</th>
                                         <th translate>label.status</th>
                                         <th translate>label.lastErrorMessage</th>
                                         <th translate>label.size</th>
                                         <th translate>label.integrityHash</th>
                                     </tr>
                                     </thead>
                                     <tbody>
                                     <tr ng-repeat="file in transfer.files">
                                         <td ng-if="permission.YADE.execute.transferStart" >
                                            <label class="md-check">
                                                <input type="checkbox" data-checklist-model="object.files"
                                                       data-checklist-value="file"><i class="primary"></i>
                                            </label>
                                        </td>

                                         <td>{{file.sourceName}}</td>
                                         <td>{{file.sourcePath}}</td>
                                         <td>{{file.targetName}}</td>
                                         <td>{{file.targetPath}}</td>
                                         <td><span uib-tooltip="{{file.error.message}}" class="label" ng-class="bgColorFunction(file.state.severity)" ng-bind="file.state._text | translate"></span></td>
                                         <td>{{file.error}}</td>
                                         <td>{{file.size | byteToSize}}</td>
                                         <td>{{file.integrityHash}}</td>
                                     </tr>
                                     </tbody>
                                 </table>
                                 <div ng-if="transfer.files.length==0" translate>message.noFileFound</div>
                             </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="inline text-sm m-l-xs m-b-sm" ng-class="{'m-t-xs m-l-sm': filtered2.length > 10}" ng-if="filtered2.length >0"><span translate>label.total</span> {{filtered2.length}}
                        <span translate ng-if="filtered2.length >1">label.fileTransfersFound</span>
                        <span translate ng-if="filtered2.length ==1">label.fileTransferFound</span>
                    </div>
                    <ul ng-show="filtered2.length > userPreferences.entryPerPage" uib-pagination total-items="filtered2.length" ng-model="yadeFilters.currentPage" items-per-page='userPreferences.entryPerPage' class="pagination-sm text-sm m-t-0 pull-right" max-size="5" boundary-link-numbers="true" rotate="false" previous-text="{{'button.prev' | translate}}" next-text="{{'button.next' | translate}}"></ul>
                    <div class="pull-left" ng-show="filtered2.length > 10">
                            <div class="btn-group m-r-xxs">
                                <button class="btn btn-default white btn-sm" ng-model="userPreferences.entryPerPage" uib-btn-radio="'10'"
                                        ng-class="{'primary': userPreferences.entryPerPage=='10'}" >10
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="userPreferences.entryPerPage" uib-btn-radio="'25'"
                                        ng-class="{'primary': userPreferences.entryPerPage=='25'}" >25
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="userPreferences.entryPerPage" uib-btn-radio="'50'"
                                        ng-class="{'primary': userPreferences.entryPerPage=='50'}" >50
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="userPreferences.entryPerPage" uib-btn-radio="'100'"
                                        ng-class="{'primary': userPreferences.entryPerPage=='100'}">100
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="userPreferences.entryPerPage" uib-btn-radio="{{maxEntryPerPage}}"
                                        ng-class="{'primary': userPreferences.entryPerPage==maxEntryPerPage}">{{maxEntryPerPage}}
                                </button>
                            </div>
                    </div>
                    <div ng-if="isLoading && fileTransfers.length==0" class="text-center m-t-md h6 text-uppercase" translate>message.noFilesFound</div>
                    <div class="text-center m-t text-uppercase hide text-orange" ng-class="{'show': (filtered2.length===0 && fileTransfers.length !==0)}" translate>message.noDataMatched</div>
                </div>
            </div>
        <div ng-if="!isLoading" class="text-center m-t-lg" >
            <div class="cssload-loading">{{'label.loading' | translate}}...</div>
        </div>
    </div>
</div>
<script>
    $('.table-responsive').on('show.bs.dropdown', function (e) {
        var $menu = $(e.target).find('.more-option-h');
        if ($menu.offset().top + 70 > $(window).innerHeight() + $(window).scrollTop()) {
            $('.dropdown-menu-list').css('top', $(window).innerHeight() - 70 + 'px');
            $('.dropdown-menu-list').removeClass('dropdown-ac');
            $('.dropdown-menu-list').addClass('dropdown-list');
        } else {
            $('.dropdown-menu-list').css('top', $menu.offset().top + 20 + 'px');
        }
        $('.dropdown-menu-list').addClass('list-dropdown');
        $('.dropdown-menu-list').css('left', $menu.offset().left + 'px');
    });

    $('.table-responsive').on('hide.bs.dropdown', function () {
        $('.dropdown-menu-list').removeClass('list-dropdown');
        $('.dropdown-menu-list').removeClass('dropdown-list');
        $('.dropdown-menu-list').addClass('dropdown-ac');
    });
</script>
