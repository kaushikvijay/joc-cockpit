<div ng-click="refreshSession()">
    <div class="modal-header">
        <button type="button" class="close" ng-click="cancel()" aria-label="Close"><span aria-hidden="true"
                                                                                         class="fa fa-times-circle"></span>
        </button>
        <h4 class="modal-title"><span translate>label.expressionEditor</span> : {{expression.label | translate}}</h4>
    </div>
    <form name="form" ng-submit="ok()" novalidate>
        <div class="modal-body p-a">
            <div class="form-group row">
                <div class="col-sm-3 p-r-0" >
                    <div class="box-shadow p-l-sm" style="height: 123px">
                        <div class="b-b p-b-sm p-t"><a class="text-hover-primary text" ng-click="generateExpression(null,'returncode')">returncode</a></div>
                        <div class="b-b p-b-sm p-t-sm"><a class="text-hover-primary text" ng-click="generateExpression(null,'event')">event</a></div>
                        <div class="p-t-sm"><a class="text-hover-primary text" ng-click="generateExpression(null,'fileexist')">fileexist</a></div>
                    </div>
                </div>
                <div class="col-sm-9">
                    <textarea rows="5" class="form-control" required ng-model="expression.expression" placeholder="returncode:x, event:event, fileexist:filename" autofocus
                              ng-change="validateExpression()" ng-keypress="getSuggestion($event)"  name="expression"></textarea>
           	    <div class="dropdown-menu dropdown dropdown-more" id="event-suggestion">
                        <a class="dropdown-item" ng-click="addSuggestion(func)" ng-repeat="func in functions">{{func}}</a>
                    </div>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-12">
                    <div class="text-center">
                        <div>
                            <button type="button" ng-click="generateExpression('and', null)"
                                    class="btn btn-sm btn-grey m-l-xs"> AND
                            </button>
                            <button type="button" ng-click="generateExpression('or', null)"
                                    class="btn btn-sm btn-grey m-l-xs"> OR
                            </button>
                            <button type="button" ng-click="generateExpression('not', null)"
                                    class="btn btn-sm btn-grey m-l-xs"> NOT
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div ng-if="expression.label == 'InCondition'">
                <div class="form-group row">
                    <div class="col-md-10 _600" translate>label.commandList</div>
                </div>
                <div class="form-group row m-b-0" ng-repeat="command in expression.commands;">
                    <div class="col-sm-5 m-b-sm" ng-if="$index==0" translate>label.command</div>
                    <div class="col-sm-6 m-b-sm" ng-if="$index==0" translate>label.commandParam</div>
                    <div class="col-sm-5 m-b-sm">
                        <select class="form-control" name="command{{$index}}" ng-change="selectCommand(expression.commands, command.command, $index)" ng-model="command.command">
                            <option value="" translate>label.chooseCommand</option>
                            <option value="start_job">start_job</option>
                            <option value="show_log">show_log</option>
                            <option value="create_event">create_event</option>
                            <option value="delete_event">delete_event</option>
                        </select>
                    </div>
                    <div class="col-sm-6 m-b-sm" ng-class="{ 'has-error' : form.atTime.$invalid && form.atTime.$dirty }">
                        <input ng-if="command.command !== 'start_job'" type="text" class="form-control" name="commandParam{{$index}}"
                               ng-model="command.commandParam">
                        <input ng-if="command.command == 'start_job'" valid-date-regex ng-required="command.command == 'start_job'" type="text" class="form-control" name="atTime"
                               ng-model="command.commandParam" placeholder="{{'placeholder.enterStartTime' | translate}}">
                        <div ng-if="command.command == 'start_job'" class="help-block text-danger" ng-messages="form.atTime.$error">
                            <div ng-message="invalid" translate>message.invalid</div>
                            <div ng-message="required" translate>message.requiredError</div>
                        </div>
                    </div>
                    <div class="col-sm-1 p-l-0">
                        <a><i ng-click="removeCommand(expression.commands, $index)"
                              class="fa fa-times m-t-sm text-hover-color"></i></a>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-10">
                        <a class="text-u-l" ng-if="expression.commands.length>0"
                           ng-click="addCommand(expression)" translate>button.addAnotherInconditionCommands</a>
                        <a class="text-u-l" ng-if="expression.commands.length==0"
                           ng-click="addCommand(expression)" translate>button.addInconditionCommands</a>
                    </div>
                </div>
            </div>
            <div ng-if="expression.label == 'OutCondition'">
                <div class="form-group row">
                    <div class="col-md-10 _600" translate>label.eventList</div>
                </div>
                <div class="form-group row m-b-0" ng-repeat="event in expression.events;">
                    <div class="col-sm-11 m-b-sm" ng-if="$index==0" translate>label.event</div>
                    <div class="col-sm-11 m-b-sm">
                        <input type="text" class="form-control" name="event{{$index}}" ng-model="event.event">
                    </div>
                    <div class="col-sm-1 p-l-0">
                        <a><i ng-click="removeEvent(expression.events, $index)"
                              class="fa fa-times m-t-sm text-hover-color"></i></a>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-10">
                        <a class="text-u-l" ng-if="expression.events.length>0"
                           ng-click="addEvent(expression)" translate>button.addAnotherOutconditionEvents</a>
                        <a class="text-u-l" ng-if="expression.events.length==0"
                           ng-click="addEvent(expression)" translate>button.addOutconditionEvents</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer text-left">
            <button type="submit" class="btn btn-primary btn-sm" translate ng-disabled="form.$invalid">button.submit
            </button>
            <button type="button" class="btn btn-grey btn-sm m-l-sm" ng-click="cancel()" translate>button.cancel
            </button>
        </div>
    </form>
</div>
<style>
    textarea {
        resize: none;
    }
</style>
