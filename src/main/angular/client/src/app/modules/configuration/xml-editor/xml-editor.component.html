<div class="white box-shadow sub-header">
  <div class="row">
    <div class="col-md-12">
      <div class="padding">
        <div class="text-right">
          <div class="pull-left">
            <app-breadcrumbs></app-breadcrumbs>
          </div>
          <div class="inline">
            <span class="badge" [ngClass]="validConfig?'badge-success':'badge-danger'"
                  translate>{{validConfig ? 'xml.label.validate' : 'xml.label.nonValidate'}}</span>
            <button class="btn btn-sm btn-grey m-l-12" (click)="newFile()" placement="bottom"
                    ngbTooltip="{{'xml.button.new' | translate}}">
              <i class="fa fa-file"></i>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" (click)="importXML()" placement="bottom"
                    ngbTooltip="{{'xml.button.importXML' | translate}}">
              <i class="fa fa-upload"></i>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" placement="bottom"
                    ngbTooltip="{{'xml.button.export' | translate}}" (click)="save()">
              <i class="fa fa-download"></i>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" (click)="showXml()" placement="bottom"
                    ngbTooltip="{{'xml.button.showXML' | translate}}">
              <i class="fa fa-television"></i>
            </button>
            <button class="btn btn-sm btn-grey m-l-12" placement="bottom"
                    ngbTooltip="{{'xml.button.validate' | translate}}" (click)="validate()">
              <i class="fa fa-check"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="sub-link">
  <div class="row">
    <div class="col-md-8">
      <div>
        <ul class="nav navbar-nav navbar-nav-inline nav-active-border nav-active-border2 b-primary">
          <li class="nav-item">
            <a class="nav-link" [routerLink]="['/configuration/designer']" [routerLinkActive]="['active']">
              <span class="nav-text text-dark p-b-sm"><span translate>configuration.tab.designer</span></span>
            </a>
          </li>
          <li class="nav-item dropdown-separator">
            <span class="separator"></span>
          </li>
          <li class="nav-item">
            <a class="nav-link" [routerLink]="['/configuration/yade']" [routerLinkActive]="['active']">
              <span class="nav-text text-dark p-b-sm"><span translate>configuration.tab.yade</span></span>
            </a>
          </li>
          <li class="nav-item dropdown-separator">
            <span class="separator"></span>
          </li>
          <li class="nav-item">
            <a class="nav-link" [routerLink]="['/configuration/notification']" [routerLinkActive]="['active']">
              <span class="nav-text text-dark p-b-sm"><span translate>configuration.tab.notification</span></span>
            </a>
          </li>
          <li class="nav-item dropdown-separator">
            <span class="separator"></span>
          </li>
          <li class="nav-item">
            <a class="nav-link" [routerLink]="['/configuration/others']" [routerLinkActive]="['active']">
              <span class="nav-text text-dark p-b-sm"><span translate>configuration.tab.others</span></span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<div class="scroll-y max-ht2">
  <div class="padding p-b-0" [hidden]="isLoading">
    <div class="center-block open" [ngClass]="!submitXsd ? 'show': 'hide'">
      <div *ngIf="objectType === 'OTHER'">
        <div class="col-md-offset-2 col-md-8 m-t-lg">
          <h1 class="text-center"><strong translate>xml.label.assignSchema</strong></h1>
          <hr>
        </div>
        <div class="col-md-offset-2 col-md-8 m-t-md">
          <span class="form-group">
            <select class="form-control" [(ngModel)]="selectedXsd" name="schema" (change)="changeXSD(selectedXsd)">
              <option [value]="''">{{'xml.label.chooseFile' | translate}}</option>
              <option [value]="'systemMonitorNotification'">{{'xml.label.systemMonitorNotification' | translate}}</option>
              <option [value]="'yade'">{{'xml.label.yade' | translate}}</option>
              <option [value]="'JSSuiteInventory'">{{'xml.label.jsSuiteInventory' | translate}}</option>
            </select>
          </span>
        </div>
        <div class="col-md-offset-2 col-md-8 m-t-md">
          <span class="form-group">
            <a class="btn btn-primary btn-sm" (click)="submit()" translate>xml.button.assign</a>
          </span>
        </div>
      </div>
      <div class="text-center m-t hide show" *ngIf="XSDState.warning && XSDState.warning.code === 'XMLEDITOR-401'">{{XSDState.warning.code | translate}}</div>
      <div class="text-center m-t h6 text-uppercase hide show"
        *ngIf="(XSDState.message && XSDState.message.code === 'XMLEDITOR-105') || (XSDState.warning &&
       XSDState.warning.code === '401')">{{XSDState.message.code | translate}}</div>
    </div>
    <div class="inline w-full" [ngClass]="submitXsd ? 'show': 'hide'">
      <div appResizable class="sticky leftPanel editor" id="leftSidePanel">
        <div class="editor-tree">
            <div class="row" *ngIf="nodes.length > 0">
              <div class="col-12">
                <a class="text" (click)="expandAll();" placement="bottom" ngbTooltip="{{'tooltip.expandAll' | translate}}">
                  <i class="fa fa-angle-double-down fa-lg"></i>
                </a>
                <a class="text m-l-xs" (click)="collapseAll();" placement="bottom" ngbTooltip="{{'tooltip.collapseAll' | translate}}">
                  <i class="fa fa-angle-double-up fa-lg"></i>
                </a>
              </div>
            </div>
            <div class="tree-block">
              <tree-root #treeCtrl [options]="options" (toggleExpanded)="toggleExpanded($event)"
                         [nodes]="nodes">
                <ng-template #treeNodeWrapperTemplate let-index="index" let-node>
                  <div class="node-wrapper">
                    <span *ngIf="node.hasChildren"
                          [class.toggle-children-wrapper-expanded]="node.isExpanded"
                          [class.toggle-children-wrapper-collapsed]="node.isCollapsed"
                          (click)="node.mouseAction('expanderClick', $event)" class="w-15 cursor">
                      <span *ngIf="node.isCollapsed" class="fa fa-angle-right fa-lg p-r-10"></span>
                      <span *ngIf="node.isExpanded" class="fa fa-angle-down fa-lg p-r-10"></span>
                    </span>
                    <span *ngIf="!node.hasChildren" class="fa fa-caret-right fa-lg w-15 m-t-xs"></span>
                    <div class="node-content-wrapper" [ngClass]="{'node-content-wrapper-active' :selectedNode && selectedNode.ref === node.data.ref && selectedNode.uuid === node.data.uuid}"
                        (treeDrop)="node.onDrop($event)"
                        [treeAllowDrop]="node.allowDrop"
                        (treeDropDragOver)="node.mouseAction('dragOver', $event)"
                        [treeDrag]="node"
                        [treeDragEnabled]="node.allowDrag()">
                      <span (click)="getData(node.data);addContent(node.data.values)"
                            [ngClass]="cutData && node.data.uuid === copyItem.uuid? 'disabled' : ''"
                            (mouseover)="tooltip(node.data)" placement="bottom" ngbTooltip="{{tooltipAttrData? tooltipAttrData: ''}}">{{node.data.ref}}
                      </span>
                      <span class="text-sm pl-2" (click)="getData(node.data)" *ngIf="node.data.attributes && node.data.attributes.length>0 && node.data.attributes[0].data">
                        {{node.data.attributes[0].name}}={{node.data.attributes[0].data}}
                      </span>
                      <span class="text-sm pl-2" (click)="getData(node.data);addContent(node.data.values)" *ngIf="!node.data.attributes && (node.data.values && node.data.values.length>0) && node.data.values[0].base !== 'password'">
                        {{removeTag(node.data.values[0])}}
                      </span>
                      <span class="text-sm pl-2" (click)="getData(node.data);addContent(node.data.values)" *ngIf="!node.data.attributes && (node.data.values && node.data.values.length>0) && node.data.values[0].base == 'password'">
                        {{passwordLabel(node.data.values[0].data)}}
                      </span>
                    </div>
                    <div class="btn-group dropdown">
                      <button class="btn-drop more-option-h" data-toggle="dropdown" type="button" (click)="checkChildNode(node.data);checkRules(node.data, copyItem);setDropdownPosition(node.uuid, $event);checkChoice(node.data);checkOrder(node);" appDropdown>
                        <i class="fa fa-ellipsis-h"></i>
                      </button>
                      <div id="menu" class="dropdown-menu dropdown-ac dropdown-more list-dropdown" role="menu">
                        <a class="dropdown-item" id="addChild" [ngClass]="(node.parent == '#' || childNode.length>0) ? '':'disabled'">
                          <div translate>xml.button.addChild</div>
                        </a>
                        <div *ngIf="childNode && childNode.length>0" [ngClass]="(childNode.length>4) ? 'childNodeScroll' : ''">
                          <a class="dropdown-item" [ngClass]="getCustomCss(child,node.data)" *ngFor="let child of childNode; let i=index" (click)="addChild(child, node.data, true, i); addDefaultValue(child)">
                            <div class="p-l-sm w-full">
                              <a ><i class="fa fa-angle-right"></i>&nbsp;{{child.ref}}</a>
                            </div>
                          </a>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" (click)="showAllChildNode(node.data)" [ngClass]="(node.parent == '#' || childNode.length>0) ? '':'disabled'">
                          <div translate>xml.button.showAllChildNodes</div>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a (click)="expandNode(node.data)"
                           [ngClass]="node.data.nodes && node.data.nodes.length>0? '':'disabled'"
                           class="dropdown-item">
                          <div translate>xml.button.expand</div>
                        </a>
                        <a (click)="collapseNode(node.data)"
                           [ngClass]="node.data.nodes && node.data.nodes.length>0? '':'disabled'"
                           class="dropdown-item">
                          <div translate>xml.button.collapse</div>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a (click)="cutNode(node.data)" *ngIf="node.data && node.data.parent !=='#'"
                           [ngClass]="cutData? 'disabled' : ''" class="dropdown-item">
                          <div translate>xml.button.cut</div>
                        </a>
                        <a (click)="copyNode(node.data)" class="dropdown-item">
                          <div translate>xml.button.copy</div>
                        </a>
                        <a (click)="pasteNode(node.data)" [ngClass]="checkRule == true? '':'disabled'"
                           class="dropdown-item">
                          <div translate>xml.button.paste</div>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a (click)="removeNode(node.data, treeCtrl)"
                           [ngClass]="node.data && node.data.parent!=='#'? '':'disabled'"
                           class="dropdown-item">
                          <div translate>xml.button.remove</div>
                        </a>
                      </div>
                    </div>
                  </div>
                </ng-template>
              </tree-root>
            </div>
          </div>
          <div class="rg-right"><span></span></div>
      </div>
      <div class="centerPanel" id="centerPanel">
        <div class="row">
          <nav class="col-12" aria-label="breadcrumb" *ngIf="breadCrumbArray.length>0">
            <ol class="breadcrumb">
              <li class="breadcrumb-item" *ngFor="let crumb of breadCrumbArray; let i = index" [ngClass]="i==breadCrumbArray.length-1? 'text-primary' : ''" aria-current="page"><a (click)="getData(crumb)">{{crumb.ref}}</a></li>
            </ol>
          </nav>
          <div *ngIf="selectedNode && selectedNode.ref" class="col-12">
            <div class="text-md m-b _600 b-b p-b-sm">{{selectedNode.ref}}</div>
          </div>
          <div class="col-12">
            <div class="box p-a documentation-height documents" *ngIf="selectedNode && selectedNode.text">
              <div class="text _600" translate>xml.label.documentation</div>
              <span id="doc">
                <ul *ngIf="selectedNode && selectedNode.text && selectedNode.text.source" class="pl-5">
                  <li><a class="text-primary" href="{{selectedNode.text.source}}" target="_blank">{{selectedNode.text.source}}</a></li>
                </ul>
                <div *ngIf="selectedNode && selectedNode.text">
                  <div [innerHTML]="selectedNode.text.doc | safeHtml"></div>
                </div>
              </span>
            </div>
          </div>
          <div class="col-12" id="attr">
            <div *ngIf="selectedNode">
              <div class="box p-a attr" *ngIf="selectedNode.attributes && selectedNode.attributes.length>0">
                <div *ngIf="selectedNode.attributes && selectedNode.attributes.length>0 && selectedNode.attributes[0].id" class="_600 text m-b-sm" translate>xml.label.attributes</div>
                <div *ngFor="let node of selectedNode.attributes; let i= index" class="form-group">
                  <label *ngIf="node.name && node.id">{{node.name}}<sup
                    *ngIf="node.use==='required' || !node.use" class="text-danger text-sm">*</sup></label>
                  <span (click)="gotoKey(node)" *ngIf="node.refer" class="pull-right">&nbsp;<a translate>xml.button.gotoKeyElement</a></span>
                  <span (click)="gotoKeyref(node)" *ngIf="node.refElement"
                        class="pull-right">&nbsp;<a translate>xml.button.gotoRefElement</a></span>
                  <span *ngIf="node.text" class="float-right" id="{{node.id}}" data-toggle="tooltip" data-placement="left" (mouseover)="getpos(node.id)" title="{{node.text.doc}}">
                      <i class="fa fa-info-circle"></i>
                  </span>
                  <input #localref1 (blur)="validateAttr(localref1.value, node)"
                         (change)="submitData(localref1.value, node)"
                         *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:string' && !node.refer"
                         [ngClass]="error && errorName === node.name? 'invalid': ''"
                         [required]="node.use ==='required'"
                         class="form-control" id="{{node.name}}" placeholder="Example input" type="text"
                         value="{{node.data? node.data:node.default}}" [autofocus]="i==0">
                  <input #localref1 (blur)="validateAttr(localref1.value, node)"
                         (change)="submitData(localref1.value, node)"
                         *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:NCName'"
                         [ngClass]="error && errorName === node.name? 'invalid': ''"
                         [required]="node.use ==='required'"
                         class="form-control" id="{{node.name}}" placeholder="Example input" type="text"
                         value="{{node.data? node.data:node.default}}" [autofocus]="i==0">
                  <input #localref9 (blur)="validateAttr(localref9.value, node)"
                         (change)="submitData(localref9.value, node)"
                         *ngIf="node.values && node.values.length==0 && node.name && node.name !== 'password' && !node.type && !node.refer"
                         [ngClass]="error && errorName === node.name? 'invalid': ''"
                         [required]="node.use ==='required'" class="form-control"
                         id="{{node.name}}" placeholder="Example input" type="text"
                         value="{{node.data? node.data:node.default}}" [autofocus]="i==0">
                  <input #localref10 (blur)="validateAttr(localref10.value, node)"
                         (change)="submitData(localref10.value, node)"
                         *ngIf="node.values && node.values.length==0 && node.type=='password'"
                         [ngClass]="error && errorName === node.name? 'invalid': ''"
                         [required]="node.use ==='required'" class="form-control"
                         id="{{node.name}}" placeholder="Example input" type="password"
                         value="{{node.data? node.data:node.default}}" [autofocus]="i==0">
                  <input #localref2 (blur)="validateAttr(localref2.value, node)"
                         (change)="submitData(localref2.value, node)"
                         *ngIf="node.name && node.type === 'xs:NMTOKEN' && !node.refer"
                         [ngClass]="error && errorName === node.name? 'invalid': ''"
                         [required]="node.use ==='required'" class="form-control"
                         id="{{node.name}}" placeholder="Example input" title="{{node.name}} should not contain spaces"
                         type="text" value="{{node.data? node.data:node.default}}" [autofocus]="i==0">
                   <input #localref2 (blur)="validateAttr(localref2.value, node)"
                         (change)="submitData(localref2.value, node)"
                         *ngIf="node.name && node.type === 'xs:anyURI' && !node.refer"
                         [ngClass]="error && errorName === node.name? 'invalid': ''"
                         [required]="node.use ==='required'" class="form-control"
                         id="{{node.name}}" placeholder="Example input" title="{{node.name}} should not contain spaces"
                         type="url" value="{{node.data? node.data:node.default}}" [autofocus]="i==0">
                  <select #localref6 (blur)="validateAttr(localref6.value, node)"
                          (change)="submitData(localref6.value, node)" (focus)="getDataAttr(node.refer)"
                          *ngIf="node.values && node.values.length==0 && node.name && (node.type === 'xs:NMTOKEN' || node.type === 'xs:string' || !node.type) && node.refer"
                          [ngClass]="error && errorName === node.name? 'invalid': ''" [ngModel]="node.data" [required]="node.use ==='required'" class="form-control"
                          id="{{node.name}}">
                    <option value=""></option>
                    <option *ngFor="let key of tempArr" value="{{key}}">{{key}}</option>
                  </select>
                  <input #localref3 (blur)="validateAttr(localref3.value, node)"
                         (change)="submitData(localref3.value, node)"
                         *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:integer'"
                         [ngClass]="error && errorName === node.name? 'invalid': ''"
                         [required]="node.use ==='required'" class="form-control"
                         id="{{node.name}}" placeholder="Example input" required
                         type="number" value="{{node.data? node.data:node.default}}" [autofocus]="i==0">
                  <input #localref4 (blur)="validateAttr(localref4.value, node)"
                         (change)="submitData(localref4.value, node)"
                         *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:positiveInteger'"
                         [ngClass]="error && errorName === node.name? 'invalid': ''"
                         [required]="node.use ==='required'" class="form-control"
                         id="{{node.name}}" min="0" placeholder="Example input" type="number"
                         value="{{node.data?node.data:node.default}}" [autofocus]="i==0">
                  <select #localref5 (blur)="validateAttr(localref5.value, node)"
                          (change)="submitData(localref5.value, node)"
                          *ngIf="node.values && node.values.length==0 && node.name && node.type === 'xs:boolean'"
                          [ngClass]="error && errorName === node.name? 'invalid': ''"
                          [(ngModel)]="node.data? node.data: node.default" [required]="node.use ==='required'"
                          class="form-control" id="{{node.name}}">
                    <option>true</option>
                    <option>false</option>
                  </select>
                  <select #localref6 (blur)="validateAttr(localref6.value, node)"
                          (change)="submitData(localref6.value, node)" *ngIf="node.values && node.values.length > 0"
                          [ngClass]="error && errorName === node.name? 'invalid': ''"
                          [(ngModel)]="node.data? node.data: node.default" [required]="node.use ==='required'"
                          class="form-control" id="{{node.name}}">
                    <option *ngFor="let value of node.values" [ngClass]="value.base ? 'hide':''">{{value.value}}</option>
                  </select>
                  <div *ngIf="error && errorName === node.name" [innerText]="text" class="help-block text-danger"
                       id="{{node.name}}Alert" role="alert">
                  </div>
                </div>
              </div>
              <div class="box p-a val" *ngIf="selectedNode.values && selectedNode.values.length>0">
                <div class="text m-b-sm" translate>xml.label.value<sup
                  *ngIf="!(selectedNode.values && selectedNode.values[0].use)" class="text-danger text-sm">*</sup></div>
                <div class="form-group">
                  <input #localref7 (blur)="validValue(localref7.value, selectedNode.ref, selectedNode.values[0])"
                         (change)="submitValue(localref7.value, selectedNode.ref, selectedNode.values[0])"
                         *ngIf="selectedNode && selectedNode.values && selectedNode.values[0].base  && (selectedNode.values[0].base !== 'xs:boolean' && selectedNode.values[0].base !== 'password')  && selectedNode.values[0].parent === selectedNode.ref && !selectedNode.values[0].values && selectedNode.ref !== 'Message' && selectedNode.ref !== 'Body'"
                         [ngClass]="error? 'invalid': ''"
                         class="form-control" id="{{selectedNode.ref}}" placeholder="Example input"
                         type="text" value="{{selectedNode.values[0].data? selectedNode.values[0].data:''}}" [autofocus]="!selectedNode.attributes">

                  <input #localref7 (blur)="validValue(localref7.value, selectedNode.ref, selectedNode.values[0])"
                         (change)="submitValue(localref7.value, selectedNode.ref, selectedNode.values[0])"
                         *ngIf="selectedNode && selectedNode.values && !selectedNode.values[0].values && selectedNode.values[0].base && selectedNode.values[0].base !== 'xs:boolean' && selectedNode.values[0].parent === selectedNode.ref && selectedNode.ref !== 'Message' && selectedNode.ref !== 'Body' && selectedNode.values[0].base == 'password'"
                         [ngClass]="error? 'invalid': ''"
                         class="form-control" id="{{selectedNode.ref}}" placeholder="Example input"
                         type="password" value="{{selectedNode.values[0].data? selectedNode.values[0].data:''}}" [autofocus]="!selectedNode.attributes">

                  <div *ngIf="selectedNode.ref === 'Body' && selectedNode.values[0]" class="form-group has-feedback">
                       <ckeditor #myckeditor="ngModel" id="{{selectedNode.uuid}}" [editor]="Editor" (change)="onChange(myContent, selectedNode)" [(ngModel)]="myContent" debounce="500" name="myckeditor" class="ckEditor" [ngClass]="error ? addCkCss(selectedNode.uuid) : removeCkCss(selectedNode.uuid)"></ckeditor>
                       <div *ngIf="myckeditor.invalid && myckeditor.touched" class="help-block" translate>xml.message.requiredField</div>
                  </div>
                  <select #localref7 (blur)="validValue(localref7.value, selectedNode.ref, selectedNode.values[0])"
                          (change)="submitValue(localref7.value, selectedNode.ref, selectedNode.values[0])"
                          *ngIf="selectedNode && selectedNode.values && selectedNode.values[0].base === 'xs:boolean'"
                          [ngClass]="error? 'invalid': ''" class="form-control" id="{{selectedNode.ref}}"
                          value="{{selectedNode.values[0].data? selectedNode.values[0].data:''}}">
                    <option>true</option>
                    <option>false</option>
                  </select>
                  <select #localref7 (blur)="validValue(localref7.value, selectedNode.ref, selectedNode.values[0])"
                          (change)="submitValue(localref7.value, selectedNode.ref, selectedNode.values[0])"
                          *ngIf="selectedNode && selectedNode.values && selectedNode.values[0].values"
                          [ngClass]="error? 'invalid': ''" class="form-control" id="{{selectedNode.ref}}"
                          value="{{selectedNode.values[0].data? selectedNode.values[0].data:''}}">
                    <option *ngFor="let value of selectedNode.values[0].values">{{value.value}}</option>
                  </select>
                  <textarea #localref8 (blur)="validValue(localref8.value, selectedNode.ref, selectedNode.values[0])"
                            (change)="submitValue(localref8.value, selectedNode.ref, selectedNode.values[0])"
                            *ngIf="selectedNode.ref === 'Message'" [ngClass]="error? 'invalid': ''" class="form-control"
                            id="{{selectedNode.ref}}" rows="4"
                            value="{{selectedNode.values[0].data? selectedNode.values[0].data:''}}" autofocus></textarea>
                  <div *ngIf="error && errorName === selectedNode.ref" [innerText]="text" class="help-block text-danger"
                       id="{{nodes.ref}}Alert"
                       role="alert">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  <div class="spinner" *ngIf="isLoading">
    <div class="cssload-inner cssload-one"></div>
    <div class="cssload-inner cssload-two"></div>
    <div class="cssload-inner cssload-three"></div>
  </div>
